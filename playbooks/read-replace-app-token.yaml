
  tasks:
    - name: Copy configuration xml files to the target system
      copy:
        src: /home/LDC/ansible-inventory-check/conf/{{file.file}}.{{file.ext}}
        dest: /home/LDC/app/conf/{{file.file}}.{{file.ext}}

    - name: importing the file contents to variable
      slurp:
        src: /home/LDC/app/conf/{{file}}
      register: idb_endpoint_b64

    - name: Decoding the content from base 64 to normal text
      set_fact:
        idb_endpoint: "{{ idb_endpoint_b64.content | b64decode }}"

    - name: Print the content on the screen
      debug:
        var: idb_endpoint

    - set_fact:
        myvalue: "{{ idb_endpoint | regex_findall(regexp)}}"
      vars:
        regexp: '(?<=\@)(.*?)(?=\@)'

    - debug:
        var: myvalue

    - debug:
        msg="{{ lookup('ini', '{{item}} type=properties file=/home/LDC/ansible-inventory-check/conf/token.properties') }}"
      loop: "{{myvalue}}"
      register: myresult

    - debug:
        var : myresult

    - set_fact:
        resultingToken: "{{myresult.results}}"

    - name: Replace the token in the configuration files
      replace:
        path: /home/LDC/app/conf/purchaseOrder.xml
        regexp: '{{item.item}}'
        #replace: 'GaneshJi'
        #replace: "{{'{{item.item}}'}}"
        replace: "{{{{ lookup('ini', '{{item.item}} type=properties file=/home/LDC/ansible-inventory-check/conf/token.properties') }}}}"
      with_items: "{{resultingToken}}"


